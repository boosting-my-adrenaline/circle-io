name: Cypress tests

on: [push]

# jobs:
#     cypress-run:
#         runs-on: ubuntu-latest
#         steps:
#             - name: Checkout
#               uses: actions/checkout@v2.4.2
#             - name: Cypress.io
#               uses: cypress-io/github-action@v2.9.7
#               with:
#                   record: true
#               env:
#                   CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
#                   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
    install:
        runs-on: ubuntu-latest
        container: cypress/browsers:node14.17.6-slim-chrome100-ff99-edge
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Save build folder
              uses: actions/upload-artifact@v3
              with:
                  name: build
                  # if-no-files-found: error
                  path: build
                  # name: my-artifact
                  # path: cypress/artifacts

            - name: Cypress install
              uses: cypress-io/github-action@v2
              with:
                  runTests: false
                  build: npm run build
    # cypress-run:
    #     runs-on: ubuntu-latest
    #     container: cypress/browsers:node14.17.6-slim-chrome100-ff99-edge
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v2.4.2

    #         - name: Download the build folders
    #           uses: actions/download-artifact@v3

    #         - name: Cypress run
    #           uses: cypress-io/github-action@v2
    chrome-tests:
        runs-on: ubuntu-latest
        container: cypress/browsers:node14.17.6-slim-chrome100-ff99-edge
        needs: install
        strategy:
            fail-fast: false
            matrix:
                containers: [1, 2, 3, 4, 5]
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Download the build folders
              uses: actions/download-artifact@v3
              with:
                  name: build
                  path: build

            - name: 'CQ Tests - Chrome'
              uses: cypress-io/github-action@v2
              with:
                  # install: false
                  browser: chrome
                  record: true
                  parallel: true
                  group: 'CQ - Chrome Channels'
                  spec: cypress/integration/cq/channels/*
              env:
                  CYPRESS_PROJECT_ID: ${{ secrets.CYPRESS_PROJECT_ID }}
                  CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: 'CQ Tests - Chrome'
              uses: cypress-io/github-action@v2
              with:
                  # install: false
                  browser: chrome
                  record: true
                  parallel: true
                  group: 'CQ - Chrome Interface'
                  spec: cypress/integration/cq/interface/*
              env:
                  CYPRESS_PROJECT_ID: ${{ secrets.CYPRESS_PROJECT_ID }}
                  CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            # - name: 'CQ Tests - Firefox'
            #   uses: cypress-io/github-action@v2
            #   with:
            #       # install: false
            #       browser: firefox
            #       record: true
            #       parallel: true
            #       group: 'CQ - Firefox'
            #       spec: cypress/integration/cq/channels/*
            #   env:
            #       CYPRESS_PROJECT_ID: ${{ secrets.CYPRESS_PROJECT_ID }}
            #       CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
            #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
